version: '3.8'

services:
  # =========================
  # Infrastructure
  # =========================
  redis:
    image: redis:7
    ports:
      - '6379:6379'
    # networks:
    #   - app-network

  mysql:
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: password
    ports:
      - '3306:3306'
    volumes:
      - mysql_data:/var/lib/mysql
    healthcheck:
      test: ['CMD', 'mysqladmin', 'ping', '-h', 'localhost']
      interval: 5s
      timeout: 10s
      retries: 10
    # networks:
    #   - app-network

  # =========================
  # API Gateway
  # =========================
#   gateway:
#     build:
#       context: ./gateway
#       dockerfile: Dockerfile
#     ports:
#       - '3000:3000'
#     depends_on:
#       - redis
#     volumes:
#       - ./gateway:/usr/src/app
#       - /usr/src/app/node_modules
#     environment:
#       - NODE_ENV=development
#     command: npm run start:dev
#     restart: unless-stopped
#     networks:
#       - app-network

#   # =========================
#   # Auth Service
#   # =========================
#   auth-service:
#     build:
#       context: ./auth-service
#       dockerfile: Dockerfile
#     depends_on:
#       mysql:
#         condition: service_healthy
#       redis:
#         condition: service_started
#     environment:
#       DATABASE_URL: mysql://root:password@mysql:3306/auth_db
#       NODE_ENV: development
#     volumes:
#       - ./auth-service:/usr/src/app
#       - /usr/src/app/node_modules
#     command: sh -c "npx prisma generate && npx prisma migrate deploy && npm run start:dev"
#     restart: unless-stopped
#     networks:
#       - app-network

#   # =========================
#   # User Service
#   # =========================
#   user-service:
#     build:
#       context: ./user-service
#       dockerfile: Dockerfile
#     depends_on:
#       mysql:
#         condition: service_healthy
#       redis:
#         condition: service_started
#     environment:
#       DATABASE_URL: mysql://root:password@mysql:3306/user_db
#       NODE_ENV: development
#     volumes:
#       - ./user-service:/usr/src/app
#       - /usr/src/app/node_modules
#     command: sh -c "npx prisma generate && npx prisma migrate deploy && npm run start:dev"
#     restart: unless-stopped
#     networks:
#       - app-network

#   # =========================
#   # Job Service
#   # =========================
#   job-service:
#     build:
#       context: ./job-service
#       dockerfile: Dockerfile
#     depends_on:
#       mysql:
#         condition: service_healthy
#       redis:
#         condition: service_started
#     environment:
#       DATABASE_URL: mysql://root:password@mysql:3306/job_db
#       NODE_ENV: development
#     volumes:
#       - ./job-service:/usr/src/app
#       - /usr/src/app/node_modules
#     command: sh -c "npx prisma generate && npx prisma migrate deploy && npm run start:dev"
#     restart: unless-stopped
#     networks:
#       - app-network

#   # =========================
#   # Chat Service
#   # =========================
#   chat-service:
#     build:
#       context: ./chat-service
#       dockerfile: Dockerfile
#     ports:
#       - '3004:3004'
#     depends_on:
#       mysql:
#         condition: service_healthy
#       redis:
#         condition: service_started
#     environment:
#       DATABASE_URL: mysql://root:password@mysql:3306/chat_db
#       NODE_ENV: development
#     volumes:
#       - ./chat-service:/usr/src/app
#       - /usr/src/app/node_modules
#     command: sh -c "npx prisma generate && npx prisma migrate deploy && npm run start:dev"
#     restart: unless-stopped
#     networks:
#       - app-network

# networks:
#   app-network:
#     driver: bridge

volumes:
  mysql_data:
